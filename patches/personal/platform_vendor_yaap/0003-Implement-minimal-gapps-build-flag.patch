From 96c1bf47b92e6c3495c887ac508a49308baf9387 Mon Sep 17 00:00:00 2001
From: ahnet-69 <syedmusicrealise@gmail.com>
Date: Mon, 5 Jun 2023 16:19:57 +0500
Subject: [PATCH] Implement minimal gapps build flag

---
 config/common.mk   | 4 +++-
 config/packages.mk | 2 +-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/config/common.mk b/config/common.mk
index 2783ff7..d35e6fc 100644
--- a/config/common.mk
+++ b/config/common.mk
@@ -71,7 +71,7 @@ SYSTEMUI_OPTIMIZE_JAVA ?= true
 # Product overlay
 PRODUCT_PACKAGE_OVERLAYS += vendor/yaap/overlay
 PRODUCT_ENFORCE_RRO_EXCLUDED_OVERLAYS += vendor/yaap/overlay
-ifneq ($(TARGET_BUILD_GAPPS),true)
+ifneq (,$(filter true,$(TARGET_BUILD_GAPPS) $(TARGET_BUILD_GAPPS_MINIMAL)))
 PRODUCT_PACKAGE_OVERLAYS += vendor/yaap/overlay-vanilla
 endif
 
@@ -145,6 +145,8 @@ endif
 
 ifeq ($(TARGET_BUILD_GAPPS),true)
     $(call inherit-product-if-exists, vendor/google/gms/common/gms-full.mk)
+else ifeq ($(TARGET_BUILD_GAPPS_MINIMAL),true)
+    $(call inherit-product-if-exists, vendor/google/gms/common/gms-minimal.mk)
 else
     $(call inherit-product-if-exists, vendor/google/pixel/config.mk)
     $(call inherit-product, external/svox/svox_tts.mk)
diff --git a/config/packages.mk b/config/packages.mk
index c04cfc8..781185d 100644
--- a/config/packages.mk
+++ b/config/packages.mk
@@ -49,7 +49,7 @@ PRODUCT_ARTIFACT_PATH_REQUIREMENT_ALLOWED_LIST += \
     system/%/libfuse-lite.so \
     system/%/libntfs-3g.so
 
-ifneq ($(TARGET_BUILD_GAPPS),true)
+ifneq (,$(filter true,$(TARGET_BUILD_GAPPS) $(TARGET_BUILD_GAPPS_MINIMAL)))
 PRODUCT_PACKAGES += \
     Etar \
     ExactCalculator \
-- 
2.39.2

